<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Spinning Glitch Trail Timer</title>
<style>
  * { margin:0; padding:0; box-sizing:border-box }
  html, body { width:100%; height:100%; overflow:hidden }
  canvas { display:block; background:#f0f0f0 }
  #startStop {
    position:absolute; bottom:20px; left:50%;
    transform:translateX(-50%);
    padding:10px 20px; font-size:1.2rem;
    border:2px solid #333; border-radius:5%;
    background:#f0f0f0; cursor:pointer; z-index:10;
  }
  #startStop:hover { background:#333; color:#fff }
</style>
</head>
<body>
<canvas id="c"></canvas>
<button id="startStop">Start</button>
<script>
const canvas = document.getElementById('c');
const ctx    = canvas.getContext('2d');
const btn    = document.getElementById('startStop');
let W, H;
window.addEventListener('resize', () => {
  W = canvas.width  = innerWidth;
  H = canvas.height = innerHeight;
});
window.dispatchEvent(new Event('resize'));

// countdown
let duration = 0, remaining = 0, running = false, tick;
btn.addEventListener('click', () => {
  if (running) {
    clearInterval(tick);
    btn.textContent = 'Start';
  } else if (remaining > 0) {
    tick = setInterval(() => {
      remaining--;
      if (remaining <= 0) {
        clearInterval(tick);
        running = false;
        btn.textContent = 'Start';
      }
    }, 1000);
    btn.textContent = 'Stop';
  }
  running = !running;
});
canvas.addEventListener('click', () => {
  if (running) return;
  const input = prompt('Enter time as MMSS (e.g. 300 for 3:00):');
  if (!input) return;
  const v = parseInt(input.replace(/\D/g,''), 10);
  if (!isNaN(v)) {
    const m = Math.floor(v/100), s = v%100;
    duration = remaining = m*60 + s;
  }
});

// movement
let x = 100, y = 100;
let dx = 2, dy = 2;
const SPEED_UP = 1;
const fontSize = 100;

// rotation
let angle = 0;
let angularVelocity = 0.005;

// trail
const trail = [];
const TRAIL_DURATION = 2;

// glitch
let glitchTime = 0;
const glitchChance = 0.02, glitchDuration = 5;

function formatTime(sec) {
  const m = String(Math.floor(sec/60)).padStart(2,'0');
  const s = String(sec%60).padStart(2,'0');
  return `${m}:${s}`;
}

;(function loop(){
  const now = performance.now()/1000;
  const txt = formatTime(remaining);

  // record trail
  const hue = (now * 60) % 360;
  trail.push({ x, y, hue, t: now, txt });
  while (trail.length && now - trail[0].t > TRAIL_DURATION) trail.shift();

  // clear for trail
  ctx.clearRect(0, 0, W, H);
  ctx.font = `${fontSize}px Inter, sans-serif`;
  ctx.textBaseline = 'top';

  // draw fading rainbow trail
  for (const seg of trail) {
    const age = now - seg.t;
    const alpha = 1 - age / TRAIL_DURATION;
    ctx.fillStyle = `hsla(${seg.hue},100%,50%,${alpha})`;
    ctx.fillText(seg.txt, seg.x, seg.y);
  }

  // measure text
  const tw = ctx.measureText(txt).width;
  const th = fontSize;

  // bounce and speed-up, randomize spin on bounce
  if (x + tw >= W && dx > 0) {
    dx = -dx * SPEED_UP;
    angularVelocity = (Math.random()*0.04 - 0.02);
  }
  if (x <= 0 && dx < 0) {
    dx = -dx * SPEED_UP;
    angularVelocity = (Math.random()*0.04 - 0.02);
  }
  if (y + th >= H && dy > 0) {
    dy = -dy * SPEED_UP;
    angularVelocity = (Math.random()*0.04 - 0.02);
  }
  if (y <= 0 && dy < 0) {
    dy = -dy * SPEED_UP;
    angularVelocity = (Math.random()*0.04 - 0.02);
  }

  // update pos & angle
  x += dx; y += dy;
  angle += angularVelocity;

  // glitch logic
  if (glitchTime > 0) {
    glitchTime--;
  } else if (Math.random() < glitchChance) {
    glitchTime = glitchDuration;
  }

  // draw glitch shadows (rotated)
  if (glitchTime > 0) {
    const off = (Math.random()*10)-5;
    ctx.save();
      ctx.translate(x + tw/2, y + th/2);
      ctx.rotate(angle);
      ctx.fillStyle = 'rgba(255,0,0,0.7)';
      ctx.fillText(txt, -tw/2 + off, -th/2);
      ctx.fillStyle = 'rgba(0,0,255,0.7)';
      ctx.fillText(txt, -tw/2 - off, -th/2);
    ctx.restore();
  }

  // draw main text rotated
  ctx.save();
    ctx.translate(x + tw/2, y + th/2);
    ctx.rotate(angle);
    ctx.fillStyle = '#000';
    ctx.fillText(txt, -tw/2, -th/2);
  ctx.restore();

  requestAnimationFrame(loop);
})();
</script>
</body>
</html>
